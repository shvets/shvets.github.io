<!doctype html>
<html lang='en'>
  <head>
    <!-- Always force latest IE rendering engine or request Chrome Frame -->
    <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
    <meta content='text/html; charset=utf-8' http-equiv='Content-type'>
    <meta content="GitHub --- Alexander Shvets's Web Page" name='description'>
    <meta content='github, ruby, java, rails' name='keywords'>
    <title>GitHub --- Alexander Shvets's Web Page</title>
    <link href="../../assets/stylesheets/screen.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="../../assets/javascripts/application.js" type="text/javascript"></script>
    <link href='http://fonts.googleapis.com/css?family=Reenie+Beanie' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Cantarell' rel='stylesheet' type='text/css'>
  </head>
  <body>
    <div id='wrapper'>
      <div id='main-column'>
        <div id='logo'>
          <h1>
            <a href='/'>Alexander Shvets GitHub Home Page</a>
          </h1>
        </div>
        <div id='menu'>
          <ul>
            <li class='current_page_item'>
              <a href='/index.html'>Projects</a>
            </li>
            <li class='current_page_item'>
              <a href='/bookmarks/index.html'>Bookmarks</a>
            </li>
            <li class='current_page_item'>
              <a href='/blog/index.html'>Blog</a>
            </li>
          </ul>
        </div>
        <div id='page'>
          <h1>Using Gemfile gems inside .gemspec file</h1>
          
          <h2>Introduction</h2>
          
          <p>If you have a (or plan to create new) gem, the chance is that you also have <strong>Gemfile</strong> inside your project.
          Here we have old and new approaches to describe dependencies of your gem. They don&rsquo;t coexist well
          with each other and you have to do additional steps in order to let them work together.</p>
          
          <p>According to <a href="http://bundler.io/v1.3/rubygems.html">bundler gem help</a>, all you have to do is to create simple <strong>Gemfile</strong>
          with only one instruction (gemspec):</p>
          
          <pre><code class="ruby">
          # Gemfile
          
          gemspec
          </code></pre>
          
          <p>This instruction will look into corresponding <strong>.gemspec</strong> file (you should have it as part of your gem project).
          It will create <strong>default</strong> and <strong>development</strong> groups and fill them out according to usage of <strong>add_runtime_dependency</strong>
          and <strong>add_development_dependency</strong> calls.</p>
          
          <p>So, if you have the following <strong>my_gem.gemspec</strong> file:</p>
          
          <pre><code class="ruby">
          # my_gem.gemspec
          
          spec.add_runtime_dependency &quot;haml&quot;, [&quot;&gt;= 0&quot;]
          spec.add_runtime_dependency &quot;sass&quot;, [&quot;&gt;= 0&quot;]
          
          spec.add_development_dependency &quot;gemcutter&quot;, [&quot;&gt;= 0&quot;]
          </code></pre>
          
          <p>it will dynamically build something like this:</p>
          
          <pre><code class="ruby">
          # Gemfile
          
          group :default do
            gem &quot;haml&quot;
            gem &quot;sass&quot;
          end
          
          group :development do
            gem &quot;gemcutter&quot;
          end
          </code></pre>
          
          <p>This approach has on drawback though - you have to think in terms of .gemspec file, which is counter-intuitive.</p>
          
          <p>I propose to do it <a href="https://github.com/shvets/gemspec_deps_gen">other way around</a>. We keep all the dependencies in
          Gemfile as we would do for <strong>any other ruby project</strong>. We also keep gemspec file as <strong>ERB template</strong>, so we can generate
          resulting gemspec when we need it or as part of gem release process.</p>
          
          <h1>Installation</h1>
          
          <p>Add this line to to your Gemfile:</p>
          
          <pre><code class="ruby">
          gem &quot;gemspec_deps_gen&quot;
          </code></pre>
          
          <p>And then execute it:</p>
          
          <pre><code class="bash">
          $ bundle
          </code></pre>
          
          <h2>Usage</h2>
          
          <p>Create <strong>Gemfile</strong> file:</p>
          
          <pre><code class="ruby">
          # Gemfile
          
          group :default do
            gem &quot;haml&quot;
            gem &quot;sass&quot;
          end
          
          group :development do
            gem &quot;gemcutter&quot;
          end
          </code></pre>
          
          <p>Create <strong>my_gem.gemspec.erb</strong> file :</p>
          
          <pre><code class="ruby">
          Gem::Specification.new do |spec|
            spec.name = &quot;sample&quot;
            spec.summary = %q{Summary.}
            spec.description = %q{Description.}
            spec.email = &quot;alexander.shvets@gmail.com&quot;
            spec.authors = [&quot;Alexander Shvets&quot;]
            spec.homepage = &quot;http://github.com/shvets/sample&quot;
          
            spec.files = `git ls-files`.split($\)
            spec.test_files = spec.files.grep(%r{^(test|spec|features)/})
          
            spec.version = &quot;1.0.0&quot;
          
            &lt;%= project_dependencies %&gt;
          end
          </code></pre>
          
          <p>You can see ERB fragment (<strong>project_dependencies</strong>) included inside the body of the specification.</p>
          
          <p>Now, run this command:</p>
          
          <pre><code class="bash">
          $ gemspec_deps_gen my_gem
          </code></pre>
          
          <p>It will generate <strong>my_gem.gemspec</strong> and replace ERB fragment with dependencies from Gemfile:</p>
          
          <pre><code class="ruby">
          Gem::Specification.new do |spec|
            ...
          
            spec.add_runtime_dependency &quot;haml&quot;, [&quot;&gt;= 0&quot;]
            spec.add_runtime_dependency &quot;sass&quot;, [&quot;&gt;= 0&quot;]
            spec.add_development_dependency &quot;gemcutter&quot;, [&quot;&gt;= 0&quot;]
          
          end
          </code></pre>
          
          <p>As alternative, you can call it as <strong>rake command</strong>:</p>
          
          <pre><code class="ruby">
          require &quot;gemspec_deps_gen&quot;
          
          project_name = &#39;my_gem&#39;
          
          task :gen do
            generator = GemspecDepsGen.new project_name
          
            generator.generate_dependencies &quot;spec&quot;, &quot;#{project_name}.gemspec.erb&quot;, &quot;#{project_name}.gemspec&quot;
          end
          </code></pre>
          
          <p>And run it:</p>
          
          <pre><code class="bash">
          $ rake gen
          </code></pre>
          
          <p>It will also generate <strong>my_gem.gemspec</strong> and replace ERB fragment with dependencies from Gemfile.</p>
          <div id='footer'>
            <p id='legal'>
              &copy; All Right Reserved (2013), Alexander Shvets.
              Built with
              <a href='http://middlemanapp.com'>middleman</a>.
            </p>
          </div>
        </div>
      </div>
      <div id='sidebar'>
        
      </div>
    </div>
  </body>
</html>
